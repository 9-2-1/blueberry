简单的任务追踪

前辈做的项目过于复杂，太难用。实际上“只需要估计速度和时间”是正确的。

后端：NodeJS + read-excel-file，读取excel整理成json送到前端。计算全在前端进行。

前端：Svelte 5 (vite + typescript)

使用 pnpm run lint 检查错误。

# excel表格总体格式：

记录.xlsx(固定名称)

| t1  | t2  | t3  |
| --- | --- | --- |
| a   | b   | c   |
| d   |     | f   |

```json
[
  { "t1": "a", "t2": "b", "t3": "c" },
  { "t1": "d", "t3": "f" }
]
```

如果数值未空，则不增加条目。

一个API: get_table。全量获取。

```typescript
// 忽略表中多余的条目。
type 任务表 = {
  // "任务" 表
  名称: string;
  开始: Date;
  结束: Date;
  总数: number; // 任务进度的目标数值
  颜色?: string; // 行主题色
};

// 进度表保证记录按照时间升序排列。不升序时应出现警告。
type 进度表 = {
  时间: Date;
  名称: string; // 任务名称，和任务表对应
  进度: number; // 在 时间 达到的 进度
  用时?: Date | unknown; // 用时可选。如果不存在并非意味着“瞬间达到了进度”，反而意味着跳过（跳过已完成部分），计算速度时需要忽略
  // 注：这个地方我暂时还不清楚类似 12:34:56 这样的描述“时间长度”的数值会被解析为 Date 还是 number，用的什么单位。在 记录.xlsx 中有一个 12:34:56 的测试条目，可以用这个来测试用时的实际类型
};

// 读取表时如果类型不正确应报错。（忽略完全空白的行，安装必要的库）
type APIResponse = { success: true; 任务: 任务表[]; 进度: 进度表[] };

type APIError = { success: false; error: string };
```

前端：根据数据计算对每个任务这样的表格行  
（提示：选择合适的布局方式使其按照表格对齐。使用 `<table>` 或者更合适的工具）只需要显示，暂时不需要筛选……

| 名称   | 已完成  | 剩余   | 速度   | 日用时   | 剩余时间  | 预计完成     |
| ------ | ------- | ------ | ------ | -------- | --------- | ------------ |
| 看网课 | 0       | 25     | 0/h    | 0:00/d   | ----:--   | --/-- --:    |
| 读论文 | 5       | 12     | 0.55/h | 2:21/d   | 21:48     | 9/26 14:     |
| 比赛   | 20      | 0      | 3.12/h | 1:34/d   | 0:00      | 已完成       |
| -----  | ------- | ------ | -----  | -------- | --------- | ------------ |
| 总计   | --      | --     | --     | 3:55/d   | 21:48     | 9/26 14:     |

已完成：该任务最后一个进度记录的进度。  
剩余：总数 - 已完成  
速度：（速度累积时长）内的 完成数量 / 用时总量 [1]  
日用时：（日用时累积时长）内的 总用时 / 经过的天数 [2]  
剩余时间：剩余 / 速度  
预计完成：(现在时间+剩余时间/日用时)

用时总量为0时速度没有意义，此时速度显示为0/h，日用时为0:00/d

速度可以是负数（进度倒退）  
当速度不为正的时候不计算剩余时间（显示为 ----:--）  
当日用时不为正的时候不计算预计完成（显示为 --/-- --:）

通过 input number 框设置速度累积时长(小时)和日用时累积时长(天)，并replaceState到url。

累计时长按照时间计算（3天= `3*24*60*60` 秒）

[1][2]包含线性过渡防止平均数跳变。具体算法：  
[1]

```
完成总数=用时总量=0
对 速度任务变化，从晚到早
  跳过没有用时的记录。
  完成数量=进度-之前的进度
  如果用时总量加上当前记录的用时会超过或者达到时间范围
    则按照比例增加总量
    比例 = （时间范围 - 用时总量）/ 用时
    完成总数+=完成数量*比例
    用时总量=时间范围
    结束
  否则
    完成总数+=完成数量
    用时总量+=用时
```

[2] 与 [1] 类似。按比例累计用时和完成时间。

忽略第一个记录的用时（第一个记录意味着开始，不应该出现用时，如果有用时应出现警告）

```
记录1: 0 - // 开始
记录2: 5 15分钟 // 从记录1到记录2的时间，使用15分钟，使进度达到5
```
