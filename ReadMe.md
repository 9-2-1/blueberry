# Blueberry

Blueberry 是一个帮助跟踪任务进度和计算 Goldie 点数的工具，通过直观的方式展示任务完成情况和时间管理状态。

## 注意

9月5日发生了 Breaking Change，表格格式大量简化。

## 功能特点

- **任务进度跟踪**：记录和统计各项任务的完成情况，支持长期任务和短期任务
- **点数系统**：通过 Goldie 点数反映整体任务状态，大于0表示正常进行，小于0表示进度落后
- **实时监控**：支持通过网页实时查看点数变化和任务进度
- **报告生成**：生成详细的任务进度报告，包括每日用时、剩余时间和预计完成情况
- **灵活配置**：支持自定义工作时段和推荐用时

## 安装说明

### 前提条件

- Python 3.8+
- 相关依赖包（见 requirements.txt）

### 安装步骤

1. 克隆或下载项目到本地
2. 安装依赖包：
   ```
   pip install -r requirements.txt
   ```

## 使用方法

### 快速开始

使用提供的批处理脚本快速启动程序：

```
blueberry.cmd
```

这将自动运行主程序并生成任务报告到 blueberry.txt 文件。

### 生成报告

直接运行主程序生成任务报告：

```
python -m blueberry
```

生成的报告会在控制台显示。

### 实时网页监控

启动网页服务器实时查看点数变化和任务进度：

```
python -m blueberry -l
```

然后在浏览器中访问 http://localhost:26019 查看实时数据。

**注意**：默认监听127.0.0.1，这意味着只有本地才能访问。如果想要在其他电脑用IP方式访问，可以使用 `-H 0.0.0.0` 参数，但这会让处于同一网络的人可以通过扫描IP的方式发现。不过，即使被扫描发现，对方也只能看到点数，除了当前点数之外的数据不会泄露。

### 命令行参数

- `-W, --watch`: 保持显示并自动更新

- `-l, --live`: 开启实时点数显示HTTP网页
- `-H, --host`: 网页服务器监听地址（默认：127.0.0.1）
- `-p, --port`: 网页服务器监听端口（默认：26019）

- `-w, --workbook`: 指定表格文件路径（默认：记录.xlsx）

- `-f, --from`: 指定开始时间（格式：YYYY-MM-DDTHH:MM[:SS]）
- `-t, --time, --to`: 指定当前时间（默认为现在）
- `-e, --end`: 指定结束时间（可选）
- `-c, --changes`: 只显示变化
- `-d, --daily`: 显示今日完成
- `-o, --output`: 输出文件路径
- `-v, --verbose`: 输出调试信息

## 点数计算说明

Goldie点数综合考虑以下因素：

- 长期任务进度：根据完成百分比和预计时间计算
- 短期任务完成情况

点数规则：

- 大于0表示正常进行
- 小于0意味着无法达到预期
- 颜色标识：红 < -500 < 橙 < -200 < 黄 < 0 < 绿 < 200 < 青 < 500 < 蓝

## 隐藏机制说明

- **工作时段计算**：仅在工作时段内计算预期可用时间和平均速度，休息时段点数不会自然下降
- **推荐用时配置**：默认工作时长为6.5小时/天（8小时×80%工作-休息比），可在 `config.py` 中修改

## 数据文件格式

任务数据存储在Excel表格（记录.xlsx）中，包含以下工作表：

### 长期任务

记录需要长期跟踪的任务信息：

- 名称：任务的唯一标识符
- 时间：任务创建或修改的时间
- 标题：任务的显示名称
- 最晚结束：任务的截止时间
- 最晚开始：任务的最晚开始时间
- 总数：任务的总量（如小时数、页数等）
- 保持安排：可选，标记为 "+" 表示保持当前安排

### 长期进度

记录长期任务的进度更新：

- 名称：关联的长期任务名称
- 时间：进度记录的时间
- 进度：当前完成的进度值
- 用时：完成该进度所用的时间

### 短期任务

记录短期任务信息：

- 名称：任务的唯一标识符
- 时间：任务创建或修改的时间
- 标题：任务的显示名称
- 最晚结束：任务的截止时间
- 预计用时：完成任务预计需要的时间
- 最早开始：任务最早可以开始的时间
- 完成：任务完成的时间（可选）
- 用时：完成任务实际花费的时间（可选）

### 工作时段

定义工作日的工作时间段：

- 开始：工作时段的开始时间
- 结束：工作时段的结束时间

### 选择排序偏好

设置任务显示的排序偏好：

- 名称：偏好项名称
- 禁用：可选，标记为 "-" 表示禁用该项

## 项目结构

项目主要包含以下文件和目录：

- `blueberry/`: 主源码目录
  - `__main__.py`: 主程序入口
  - `parser.py`: 数据解析和加载
  - `models.py`: 数据模型定义
  - `webserver.py`: 网页服务器实现
  - `config.py`: 配置参数
- `web/`: 网页前端文件
- `web_ts/`: TypeScript源代码
- `blueberry.cmd`: Windows启动脚本

## 删除机制

在任何任务表中，只需添加一行只包含"名称"和"时间"两列的记录，系统会将该名称的任务视为已删除。

## 示例数据

直接创建符合上述格式的Excel文件即可开始使用。确保文件名与命令行参数中指定的一致（默认为"记录.xlsx"）。
